# device-stack – Environment Variables
# Copy to .env and fill in all values before running `docker compose up`.
#
# Prerequisites:
#   1. The tenant-stack for TENANT_ID is running.
#   2. The JOIN workflow between tenant-stack and provider-stack has completed
#      (Sub-CA signed, step-ca healthy).
#
# Usage:
#   cp .env.example .env
#   # edit .env – fill in TENANT_ID, BRIDGE_API_URL, THINGSBOARD_HOST, etc.
#   docker compose up
#
# Lines marked  # [CHANGE ME]  must be adjusted for your environment.

# ── Device identity ───────────────────────────────────────────────────────────
# Unique identifier sent to the Tenant IoT Bridge API during enrollment.
# Must be a DNS-label-safe string (lowercase, no spaces).
DEVICE_ID=sim-device-001
DEVICE_NAME=Simulated Device 001
DEVICE_TYPE=simulator

# ── Tenant identity ───────────────────────────────────────────────────────────
# Must match TENANT_ID in the target tenant-stack/.env.
# Used as MQTT topic prefix for tenant isolation: cdm/<TENANT_ID>/<DEVICE_ID>/...
TENANT_ID=tenant1                           # [CHANGE ME]

# ── Tenant-Stack endpoints ────────────────────────────────────────────────────
# On Linux + Docker Desktop, host.docker.internal resolves to the host.
# On bare Docker on Linux, set these to the host's actual IP or hostname.

# Tenant IoT Bridge API – routed via Caddy at /api
# (normally http(s)://<tenant-host>:8888/api)
BRIDGE_API_URL=http://host.docker.internal:8888/api  # [CHANGE ME]

# Tenant ThingsBoard – MQTT TLS on port 8883 (direct, not via Caddy)
THINGSBOARD_HOST=host.docker.internal       # [CHANGE ME]
THINGSBOARD_MQTT_PORT=8883

# Tenant hawkBit – routed via Caddy at /hawkbit
HAWKBIT_URL=http://host.docker.internal:8888/hawkbit  # [CHANGE ME]

# hawkBit internal tenant name (always "DEFAULT" unless you changed hawkBit's
# tenant config – this is hawkBit's own multi-tenant concept, separate from
# the CDM Tenant ID above).
HAWKBIT_TENANT=DEFAULT

# ── Tenant InfluxDB ───────────────────────────────────────────────────────────
# Port 8086 direct (SPA limitation; access via oauth2-proxy in tenant-stack).
# The device-side Telegraf uses this to forward optional additional sensor data.
# Primary device metrics flow from ThingsBoard/hawkBit via the Tenant Telegraf.
INFLUX_URL=http://host.docker.internal:8086  # [CHANGE ME]
INFLUX_TOKEN=my-super-secret-influx-token    # [CHANGE ME] – match tenant-stack INFLUX_TOKEN
INFLUX_ORG=cdm-org                           # [CHANGE ME] – match tenant-stack TENANT_ID (org)
INFLUX_BUCKET=iot-metrics

# ── Tenant Sub-CA PKI ─────────────────────────────────────────────────────────
# Fingerprint of the Tenant Sub-CA (NOT the Provider Root CA!).
# Used to bootstrap TLS trust before the enrollment HTTP call.
#
# Retrieve after the tenant-stack JOIN workflow completes:
#   docker compose -f ../tenant-stack/docker-compose.yml exec ${TENANT_ID}-step-ca \
#       step ca fingerprint
STEP_CA_FINGERPRINT=                         # [CHANGE ME]

# ── Timing ────────────────────────────────────────────────────────────────────
TELEMETRY_INTERVAL_S=30
POLL_INTERVAL_S=30

# ── Ports ─────────────────────────────────────────────────────────────────────
TTYD_PORT=7681
