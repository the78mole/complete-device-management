# ─────────────────────────────────────────────────────────────────
# Tenant Stack – Environment Variables
#
# Copy to .env and fill in all [CHANGE ME] values before starting.
#
# Usage:
#   cp .env.example .env
#   # edit .env
#   docker compose up -d
#
# Lines marked  # [CHANGE ME]  MUST be changed in production.
# Lines marked  # [AUTO]       are generated automatically by services.
# ─────────────────────────────────────────────────────────────────

# ── Tenant identity ───────────────────────────────────────────────
# Unique short identifier for this tenant (lowercase, no spaces).
# Used as container name prefix, Keycloak realm name, InfluxDB org.
TENANT_ID=tenant1

# Human-readable display name shown in dashboards and landing pages.
TENANT_DISPLAY_NAME=Acme Devices GmbH

# Timezone for WireGuard container
TZ=Europe/Berlin

# ── External URLs ─────────────────────────────────────────────────
# Browser-facing URL for the Caddy entry point (port 8888).
# In production: https://tenant1.iot.example.com
# In Codespaces: see runtime-computed value in caddy/html/index.html
EXTERNAL_URL=http://localhost:8888

# ThingsBoard UI (port 9090 direct – cannot use sub-path due to SPA)
TB_EXTERNAL_URL=http://localhost:9090

# InfluxDB UI (port 8086 direct – accessed via oauth2-proxy on :8086)
INFLUX_EXTERNAL_URL=http://localhost:8086

# Entry port for Caddy (normally 8888; change if running multiple tenants)
CADDY_PORT=8888

# ── Keycloak ──────────────────────────────────────────────────────
KC_ADMIN_USER=admin
KC_ADMIN_PASSWORD=changeme                  # [CHANGE ME]
KC_DB_PASSWORD=changeme                     # [CHANGE ME]

# OIDC client secrets (32+ random chars; unique per tenant)
GRAFANA_OIDC_SECRET=changeme                # [CHANGE ME]
TB_OIDC_SECRET=changeme                     # [CHANGE ME]
HB_OIDC_SECRET=changeme                     # [CHANGE ME]
BRIDGE_OIDC_SECRET=changeme                 # [CHANGE ME]
PORTAL_OIDC_SECRET=changeme                 # [CHANGE ME]
INFLUX_PROXY_OIDC_SECRET=changeme           # [CHANGE ME]

# Tenant user passwords (bootstrap users in realm-tenant.json.tpl)
TENANT_ADMIN_EMAIL=admin@tenant.example.com
TENANT_ADMIN_PASSWORD=changeme              # [CHANGE ME]
TENANT_OPERATOR_EMAIL=operator@tenant.example.com
TENANT_OPERATOR_PASSWORD=changeme           # [CHANGE ME]
TENANT_VIEWER_EMAIL=viewer@tenant.example.com
TENANT_VIEWER_PASSWORD=changeme             # [CHANGE ME]

# Provider Keycloak federation (filled in after JOIN workflow)
# PROVIDER_KC_URL=https://provider.iot.example.com
# PROVIDER_KC_CLIENT_ID=tenant1-federation
# PROVIDER_KC_CLIENT_SECRET=                # [CHANGE ME] after JOIN

# ── ThingsBoard ───────────────────────────────────────────────────
TB_DB_PASSWORD=changeme                     # [CHANGE ME]
TB_SYSADMIN_EMAIL=sysadmin@thingsboard.org
TB_SYSADMIN_PASSWORD=sysadmin               # [CHANGE ME]

# MQTT TLS (set to true after step-ca Sub-CA is signed and TB certs are issued)
MQTT_SSL_ENABLED=false
# NONE = no client cert required; OPTIONAL = cert optional; REQUIRED = mTLS
MQTT_SSL_CLIENT_AUTHENTICATION=NONE

# ── hawkBit ──────────────────────────────────────────────────────
HB_DB_PASSWORD=changeme                     # [CHANGE ME]
HB_DB_ROOT_PASSWORD=changeme_root           # [CHANGE ME]
HB_ADMIN_USER=admin
HB_ADMIN_PASSWORD=admin                     # [CHANGE ME]

# hawkBit internal RabbitMQ (DMF bus only – not exposed outside tenant-net)
HB_RMQ_USER=admin
HB_RMQ_PASSWORD=changeme                    # [CHANGE ME]

# ── InfluxDB ──────────────────────────────────────────────────────
INFLUX_ADMIN_USER=admin
INFLUX_ADMIN_PASSWORD=changeme00            # [CHANGE ME] – min 8 chars
INFLUX_TOKEN=my-super-secret-influx-token   # [CHANGE ME] – 64+ random chars
# 32-byte random value for the oauth2-proxy cookie (base64 or hex):
INFLUX_PROXY_COOKIE_SECRET=0123456789abcdef0123456789abcdef  # [CHANGE ME]

# Portal session secret (Express / Next.js session signing key)
PORTAL_SESSION_SECRET=change-this-portal-session-secret  # [CHANGE ME]

# ── step-ca (Tenant Issuing Sub-CA) ──────────────────────────────
STEP_CA_PKI_NAME=Tenant Sub-CA
STEP_CA_DNS_NAMES=step-ca,localhost
STEP_CA_ADMIN_PROVISIONER=tenant-admin@cdm.local
STEP_CA_ENABLE_ACME=true
STEP_CA_ENABLE_REMOTE_MGMT=true
STEP_CA_ADDRESS=:9000

# Sub-CA provisioner for IoT Bridge API (JWK provisioner)
STEP_CA_PROVISIONER_NAME=iot-bridge
STEP_CA_PROVISIONER_PASSWORD=changeme       # [CHANGE ME]

# Root password for the step-ca admin provisioner
STEP_CA_ADMIN_PASSWORD=changeme             # [CHANGE ME]

# After step-ca starts:
#   docker compose exec ${TENANT_ID}-step-ca step ca fingerprint
# and paste the value here so other services can bootstrap TLS trust.
STEP_CA_FINGERPRINT=                        # [AUTO] fill after first start

# ── Provider IoT Bridge API (JOIN workflow) ────────────────────────
# The Tenant-Stack automatically submits a JOIN request on first boot.
# Set PROVIDER_API_URL before running `docker compose up` for the first time.
#
# The step-ca Sub-CA CSR is generated locally, submitted to the Provider API,
# and polled until the Provider Admin approves.  Once approved the signed
# Sub-CA certificate is installed automatically – no manual step-ca interaction
# required.
#
# Obtain the Provider URL from the Provider-Stack operator.
PROVIDER_API_URL=                           # e.g. https://provider.iot.example.com/api
TENANT_KEYCLOAK_URL=                        # e.g. https://tenant.iot.example.com/auth  (for KC federation)
JOIN_POLL_INTERVAL=60                       # seconds between status polls
JOIN_TIMEOUT=3600                           # max seconds to wait for approval

# ── WireGuard ─────────────────────────────────────────────────────
# Publicly reachable hostname or IP for WireGuard.
# Use 'auto' to detect the public IP automatically.
WG_SERVER_URL=auto
WG_PORT=51820
WG_PEERS=10

# IMPORTANT: Each tenant MUST use a different VPN subnet.
# tenant1: 10.8.1.0   tenant2: 10.8.2.0   etc.
WG_INTERNAL_SUBNET=10.8.1.0
WG_SERVER_IP=10.8.1.1

# ── IoT Bridge API ────────────────────────────────────────────────
STEP_CA_VERIFY_TLS=false

# ── Grafana ───────────────────────────────────────────────────────
# No additional env needed – uses GRAFANA_OIDC_SECRET above.
