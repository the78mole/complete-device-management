# Environment variables for cloud-infrastructure docker-compose
# Copy this file to .env and fill in real secrets before running.
# Lines marked [CHANGE ME] MUST be replaced with strong unique values in production.

# ─────────────────────────── Keycloak ────────────────────────────
KC_DB_PASSWORD=changeme          # [CHANGE ME]
KC_ADMIN_USER=admin
KC_ADMIN_PASSWORD=changeme       # [CHANGE ME]

# ──────────────────────── ThingsBoard ────────────────────────────
TB_DB_PASSWORD=changeme          # [CHANGE ME]
TB_OIDC_SECRET=changeme          # [CHANGE ME] – must match Keycloak client secret
TB_SYSADMIN_EMAIL=sysadmin@thingsboard.org
TB_SYSADMIN_PASSWORD=sysadmin   # [CHANGE ME]

# ───────────────────────── hawkBit ───────────────────────────────
HB_DB_PASSWORD=changeme          # [CHANGE ME]
HB_DB_ROOT_PASSWORD=changeme_root # [CHANGE ME]
HB_ADMIN_USER=admin
HB_ADMIN_PASSWORD=admin          # [CHANGE ME]
HB_OIDC_SECRET=changeme          # [CHANGE ME] – must match Keycloak client secret

# ───────────────────────── InfluxDB ──────────────────────────────
INFLUX_ADMIN_USER=admin
INFLUX_ADMIN_PASSWORD=changeme00 # [CHANGE ME] – min 8 chars required by InfluxDB
INFLUX_TOKEN=my-super-secret-influx-token # [CHANGE ME]

# ───────────────────────── Grafana ───────────────────────────────
GRAFANA_OIDC_SECRET=changeme     # [CHANGE ME] – must match Keycloak client secret

# ───────────────────────── WireGuard ─────────────────────────────
WG_SERVER_URL=auto               # set to the host's public IP/FQDN in production
WG_PORT=51820
WG_PEERS=10

# ──────────────────── IoT Bridge API (glue) ──────────────────────
BRIDGE_OIDC_SECRET=changeme      # [CHANGE ME] – must match Keycloak client secret

# ════════════════════════ Step CA (PKI) ══════════════════════════
# step-ca creates a Root CA + Intermediate CA on first container
# boot using the DOCKER_STEPCA_INIT_* variables below.
# After first boot, run the operator script to add provisioners:
#   docker exec -it cdm-step-ca /usr/local/bin/init-provisioners.sh

# ── Root CA ──────────────────────────────────────────────────────
# Human-readable name embedded in both Root and Intermediate CA subjects
STEP_CA_PKI_NAME=CDM Root CA
# Comma-separated DNS names the CA HTTPS API is reachable at
STEP_CA_DNS_NAMES=step-ca,localhost
# TLS address the CA API listens on inside the container
STEP_CA_ADDRESS=:9000

# ── Intermediate CA ──────────────────────────────────────────────
# step-ca init creates a Root CA and signs an Intermediate CA with it
# in a single step. Both keys are protected by the Docker secret file
# cloud-infrastructure/step-ca/password.txt.
# [CHANGE ME] – replace the placeholder in cloud-infrastructure/step-ca/password.txt
# with a strong password before first boot.
#
# To inspect the generated Intermediate CA after first boot:
#   docker exec cdm-step-ca step certificate inspect /home/step/certs/intermediate_ca.crt

# ── Provisioner setup ────────────────────────────────────────────
# Email address used as the name for the bootstrap admin JWK provisioner
STEP_CA_ADMIN_PROVISIONER=cdm-admin@cdm.local
# Enable the built-in ACME provisioner (used by devices for cert auto-renewal)
STEP_CA_ENABLE_ACME=true
# Enable the Admin API (required for init-provisioners.sh to add more provisioners)
STEP_CA_ENABLE_REMOTE_MGMT=true
# Disable SSH CA (not needed for this IoT platform)
STEP_CA_ENABLE_SSH=false
# Name of the JWK provisioner added by init-provisioners.sh for iot-bridge-api
STEP_CA_PROVISIONER_NAME=iot-bridge
# Password for the iot-bridge JWK provisioner key   [CHANGE ME]
STEP_CA_PROVISIONER_PASSWORD=changeme

# ── Post-boot values (populated after running init-provisioners.sh) ─
# Root CA fingerprint – retrieve with:
#   docker exec cdm-step-ca step certificate fingerprint /home/step/certs/root_ca.crt
# The iot-bridge-api service will not start correctly until this is set.
STEP_CA_FINGERPRINT=RETRIEVE_AFTER_FIRST_BOOT
