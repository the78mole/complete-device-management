# provider-stack/.env.example
#
# Copy to .env and fill in your secrets before starting the stack:
#   cp .env.example .env
#
# Items marked [CHANGE ME] MUST be replaced in any non-development deployment.
# All other values are safe defaults for local dev / Codespaces evaluation.

# ── External URL ─────────────────────────────────────────────────────────────
# Browser-facing base URL of this stack (port 8888).
# Local dev:     http://localhost:8888
# GitHub Codespaces: https://<codespace-name>-8888.app.github.dev
EXTERNAL_URL=http://localhost:8888

# External URL for InfluxDB proxy (direct port 8086, separate from Caddy).
# Local dev:     http://localhost:8086
# GitHub Codespaces: https://<codespace-name>-8086.app.github.dev
INFLUX_EXTERNAL_URL=http://localhost:8086

# ── Caddy ────────────────────────────────────────────────────────────────────
# Port exposed by the Docker container (used for the docker-compose port mapping).
CADDY_PORT=8888

# Site address for Caddy's virtual host / HTTPS cert domain.
#   Dev / Codespaces:  leave EMPTY → Caddy listens on :8888 (plain HTTP)
#   Production:        set to your FQDN, e.g. cdm.example.com
#                      Also set CADDY_AUTO_HTTPS=on and expose ports 80+443.
CADDY_SITE_ADDRESS=

# Set to "on" to enable automatic HTTPS via Let's Encrypt (production only).
# Requires CADDY_SITE_ADDRESS to be a publicly reachable FQDN.
CADDY_AUTO_HTTPS=off

# E-mail address sent to Let's Encrypt for cert expiry notifications (production).
CADDY_ACME_EMAIL=

# ── Keycloak ─────────────────────────────────────────────────────────────────
KC_ADMIN_USER=admin
KC_ADMIN_PASSWORD=changeme          # [CHANGE ME]
KC_DB_PASSWORD=changeme             # [CHANGE ME]

# OIDC client secrets – must match values baked into the realm templates.
# Run `openssl rand -hex 32` to generate a fresh secret.
GRAFANA_OIDC_SECRET=changeme        # [CHANGE ME]
GRAFANA_BROKER_SECRET=changeme      # [CHANGE ME] – used by identity brokering
BRIDGE_OIDC_SECRET=changeme         # [CHANGE ME]
PORTAL_OIDC_SECRET=changeme         # [CHANGE ME]
INFLUX_PROXY_OIDC_SECRET=changeme   # [CHANGE ME]

# Bootstrap user passwords for the provider realm
PROVIDER_OPERATOR_PASSWORD=changeme # [CHANGE ME]

# ── RabbitMQ ─────────────────────────────────────────────────────────────────
RABBITMQ_ADMIN_USER=admin
RABBITMQ_ADMIN_PASSWORD=changeme    # [CHANGE ME]

# OIDC client secret for the RabbitMQ management UI → Keycloak SSO login.
# Run `openssl rand -hex 32` to generate a fresh secret and paste the same
# value into the Keycloak provider realm import (rabbitmq-management client).
RABBITMQ_MANAGEMENT_OIDC_SECRET=changeme  # [CHANGE ME]

# ── InfluxDB ─────────────────────────────────────────────────────────────────
INFLUX_ADMIN_USER=admin
INFLUX_ADMIN_PASSWORD=changeme00    # [CHANGE ME] – min 8 chars required by InfluxDB
INFLUX_TOKEN=my-super-secret-influx-token  # [CHANGE ME]

# Cookie secret for the oauth2-proxy in front of InfluxDB.
# Must be 16, 24, or 32 bytes (hex-encoded → 32, 48, or 64 hex chars).
# Generate: openssl rand -hex 32
INFLUX_PROXY_COOKIE_SECRET=0123456789abcdef0123456789abcdef  # [CHANGE ME]
# Set to "true" when serving over HTTPS (e.g. GitHub Codespaces); "false" for plain HTTP local dev
INFLUX_PROXY_COOKIE_SECURE=false
# Use "none" (requires Secure=true) for cross-site OAuth2 redirects over HTTPS; "lax" for local dev
INFLUX_PROXY_COOKIE_SAMESITE=lax

# ── Grafana ──────────────────────────────────────────────────────────────────
# No extra secrets needed – uses GRAFANA_OIDC_SECRET and INFLUX_TOKEN above.

# ── IoT Bridge API ───────────────────────────────────────────────────────────
PORTAL_SESSION_SECRET=change-this-portal-session-secret  # [CHANGE ME]

# JSON map of tenants exposed in the portal (provider-stack default: cdm only)
# Add tenant entries when tenant-stacks are onboarded, e.g.:
# '{"cdm":{"name":"CDM Platform"},"acme":{"name":"Acme Devices GmbH"}}'
PORTAL_TENANTS_JSON={"cdm":{"name":"CDM Platform"}}

# ── step-ca (PKI) ────────────────────────────────────────────────────────────
STEP_CA_PKI_NAME=CDM Root CA
STEP_CA_DNS_NAMES=step-ca,localhost
STEP_CA_ADDRESS=:9000
STEP_CA_ADMIN_PROVISIONER=cdm-admin@cdm.local
STEP_CA_ENABLE_ACME=true
STEP_CA_ENABLE_REMOTE_MGMT=true
STEP_CA_ENABLE_SSH=false

# Set by iot-bridge-api after step-ca starts (fingerprint of root CA cert).
# Run: docker exec provider-step-ca step ca fingerprint
STEP_CA_FINGERPRINT=

# JWK provisioner used by iot-bridge-api to sign device certificates
STEP_CA_PROVISIONER_NAME=iot-bridge
STEP_CA_PROVISIONER_PASSWORD=changeme  # [CHANGE ME]
STEP_CA_ADMIN_PASSWORD=changeme        # [CHANGE ME]
STEP_CA_VERIFY_TLS=false
